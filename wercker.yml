box: leipert/ubuntu14.04-webessentials
build:
    steps:
        - script:
            name: install golang
            code: |-
                export GOLANG_VERSION=1.3.3
                sudo mkdir -p /usr/local/go
                sudo chown ubuntu:ubuntu /usr/local/go
                sudo apt-get update
                sudo apt-get install bzr mercurial git -y
                export GOPATH="$HOME/go" | sudo tee -a /etc/profile
                mkdir -p "$HOME/go/{src,pkg,bin}"
                wget -O go.tar.gz https://storage.googleapis.com/golang/go$GOLANG_VERSION.linux-amd64.tar.gz
                tar -C /usr/local -xzf go.tar.gz
                rm -rf go.tar.gz
                export PATH="$PATH:/usr/local/go/bin:$GOPATH/bin" | sudo tee -a /etc/profile
        - script:
            name: install required packages
            code: sudo apt-get install git gconf2 gconf-service libgtk2.0-0 libudev1 libgcrypt11 libgnome-keyring0 gir1.2-gnomekeyring-1.0 libnotify4 libxtst6 libnss3 gvfs-bin python xdg-utils libcap2 xvfb wget bzr git mercurial -y
        - script:
            name: install and enable xvfb
            code: |-
                export DISPLAY=:99.0
                start-stop-daemon --start --pidfile /tmp/xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1024x768x24 -ac +extension GLX +extension RANDR +render -noreset
                sleep 3
        - script:
            name: install atom
            code: |-
                wget -O atom-amd64.deb https://atom.io/download/deb
                sudo dpkg -i atom-amd64.deb
                sudo apt-get install -f
                rm -rf atom-amd64.deb
        - script:
            name: apm version
            code: apm --version
        - script:
            name: install package dependencies
            code: apm install
        - script:
            name: install go dependencies
            code: |-
                go get -u github.com/golang/lint/golint
                go get -u code.google.com/p/go.tools/cmd/cover
                go get -u code.google.com/p/go.tools/cmd/goimports
                go get -u code.google.com/p/go.tools/cmd/vet
                go get -u sourcegraph.com/sqs/goreturns
        - script:
            name: run package specs
            code: apm test
